<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>How to Build a gRPC Server for a SparkFun Weather Shield - Bartlomiej Mika</title><meta name=description content="We will take what we learned in the previous post and rewrite it to support interprocess communication of our SparkFun Weather Shield from other applications using the gRPC."><meta name=author content="Mika Software Corporation"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Bartlomiej Mika","url":"https:\/\/bartlomiejmika.com"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/bartlomiejmika.com"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/bartlomiejmika.com","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/bartlomiejmika.com\/post\/2021\/how-to-build-a-grpc-server-for-a-sparkfun-weather-shield\/","name":"How to build a g r p c server for a spark fun weather shield"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Bartlomiej Mika"},"headline":"How to Build a gRPC Server for a SparkFun Weather Shield","description":"We will take what we learned in the previous post and rewrite it to support interprocess communication of our SparkFun Weather Shield from other applications using the gRPC.\n","inLanguage":"en","wordCount":2985,"datePublished":"2021-07-09T18:35:46","dateModified":"2021-07-09T18:35:46","image":"https:\/\/bartlomiejmika.com\/img\/bartlomiej_mika.jpeg","keywords":["IoT, gRPC, Golang"],"mainEntityOfPage":"https:\/\/bartlomiejmika.com\/post\/2021\/how-to-build-a-grpc-server-for-a-sparkfun-weather-shield\/","publisher":{"@type":"Organization","name":"https:\/\/bartlomiejmika.com","logo":{"@type":"ImageObject","url":"https:\/\/bartlomiejmika.com\/img\/bartlomiej_mika.jpeg","height":60,"width":60}}}</script><meta property="og:title" content="How to Build a gRPC Server for a SparkFun Weather Shield"><meta property="og:description" content="We will take what we learned in the previous post and rewrite it to support interprocess communication of our SparkFun Weather Shield from other applications using the gRPC."><meta property="og:image" content="https://bartlomiejmika.com/img/bartlomiej_mika.jpeg"><meta property="og:url" content="https://bartlomiejmika.com/post/2021/how-to-build-a-grpc-server-for-a-sparkfun-weather-shield/"><meta property="og:type" content="website"><meta property="og:site_name" content="Bartlomiej Mika"><meta name=twitter:title content="How to Build a gRPC Server for a SparkFun Weather Shield"><meta name=twitter:description content="We will take what we learned in the previous post and rewrite it to support interprocess communication of our SparkFun Weather Shield from other applications using the gRPC."><meta name=twitter:image content="https://bartlomiejmika.com/img/bartlomiej_mika.jpeg"><meta name=twitter:card content="summary"><link href=https://bartlomiejmika.com/img/favicon.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.80.0"><link rel=alternate href=https://bartlomiejmika.com/index.xml type=application/rss+xml title="Bartlomiej Mika"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://bartlomiejmika.com/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://bartlomiejmika.com/css/highlight.min.css><link rel=stylesheet href=https://bartlomiejmika.com/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-172742383-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button>
<a class=navbar-brand href=https://bartlomiejmika.com>Bartlomiej Mika</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Blog href=/>Blog</a></li><li><a title=Tags href=/tags>Tags</a></li><li><a title=About href=/about/>About</a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="Bartlomiej Mika" href=https://bartlomiejmika.com><img class=avatar-img src=https://bartlomiejmika.com/img/bartlomiej_mika.jpeg alt="Bartlomiej Mika"></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>How to Build a gRPC Server for a SparkFun Weather Shield</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on July 9, 2021
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;15&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;2985&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Bartlomiej Mika</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p><img src=/img/2021/03-27/grpc.jpg alt></p><p>We will take what we learned in the <a href=/post/2021/how-to-read-data-from-a-sparkfun-weather-shield-dev-13956-in-golang/><em>previous post</em></a> and rewrite it to support interprocess communication of our SparkFun Weather Shield from other applications using the <a href=https://grpc.io><code>gRPC</code></a>.</p><h2 id=setup-a-basic-grpc-server>Setup a Basic gRPC Server</h2><p><em>Before writing any business logic, start off by building the project scaffolding. The scaffolding we will use is found if you read the <a href=https://grpc.io/docs/languages/go/basics/>gRPC Basics tutorial</a>. Our goal is to create a simple RPC server which we can call with a client; afterwords, we&rsquo;ll focus on writing our business logic. If you don&rsquo;t know anything about gRPC then checkout <a href=/post/2021/example-of-writing-a-simple-grpc-server-in-golang-from-scratch/>this we article on gRPC basics</a>.</em></p><p>Start off by setting up the an empty repository in <a href=https://github.com/bartmika/serialreader-server>github</a> and run the following in your <code>terminal</code>:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> ~/go/src/github.com/bartmika
git clone https://github.com/bartmika/serialreader-server.git
<span class=nb>cd</span> serialreader-server</code></pre></div><p>Initialize golang modules.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>go mod init github.com/bartmika/serialreader-server</code></pre></div><p>Install our project&rsquo;s dependencies.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>export</span> <span class=nv>GO111MODULE</span><span class=o>=</span>on  <span class=c1># Enable module mode</span>
go get google.golang.org/protobuf/cmd/protoc-gen-go
go get google.golang.org/grpc/cmd/protoc-gen-go-grpc
go get google.golang.org/grpc
go get github.com/golang/protobuf/ptypes/timestamp
go get github.com/spf13/cobra
go get github.com/tarm/serial</code></pre></div><p>Setup our initial project structure. We will use this structure to grow our application. Please look at the folder and file names in the &ldquo;Project Hierarchy&rdquo; and create them in your computer as blank files.</p><h4 id=project-hierarchy>Project Hierarchy</h4><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>📁 serialreader-server
│   📄 main.go
│
└───📁 cmd
<span class=p>|</span>   <span class=p>|</span>
<span class=p>|</span>   └───📄 hello.go
<span class=p>|</span>       📄 root.go
<span class=p>|</span>       📄 serve.go
<span class=p>|</span>       📄 version.go
<span class=p>|</span>
└───📁 internal
<span class=p>|</span>   <span class=p>|</span>
<span class=p>|</span>   └───📄 server_impl.go
<span class=p>|</span>       📄 server.go
<span class=p>|</span>
└───📁 proto
    <span class=p>|</span>
    └───📄 serialreader.proto</code></pre></div><p>What are going to do? We want our project structured in such a way that it uses the <a href=https://github.com/spf13/cobra><code>spf13/cobra</code></a> package so we can easily commands in our application.</p><p>Please copy and paste the following code into those empty files.</p><h4 id=1-of-8-maingo>(1 of 8) main.go</h4><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>main</span> <span class=c1>// github.com/bartmika/serialreader-server/main.go
</span><span class=c1></span>
<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;github.com/bartmika/serialreader-server/cmd&#34;</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
	<span class=nx>cmd</span><span class=p>.</span><span class=nf>Execute</span><span class=p>()</span>
<span class=p>}</span>
</code></pre></div><h4 id=2-of-8-cmdrootgo>(2 of 8) cmd/root.go</h4><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>cmd</span> <span class=c1>// github.com/bartmika/serialreader-server/cmd/root.go
</span><span class=c1></span>
<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;fmt&#34;</span>
	<span class=s>&#34;os&#34;</span>

	<span class=s>&#34;github.com/spf13/cobra&#34;</span>
<span class=p>)</span>

<span class=kd>var</span> <span class=nx>rootCmd</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>{</span>
	<span class=nx>Use</span><span class=p>:</span>   <span class=s>&#34;serialreader-server&#34;</span><span class=p>,</span>
	<span class=nx>Short</span><span class=p>:</span> <span class=s>&#34;Serve time-series data&#34;</span><span class=p>,</span>
	<span class=nx>Long</span><span class=p>:</span>  <span class=s>`Serve time-series data from a connected Arduino device with an attached &#39;SparkFun Weather Shield&#39; device over gRPC.`</span><span class=p>,</span>
	<span class=nx>Run</span><span class=p>:</span> <span class=kd>func</span><span class=p>(</span><span class=nx>cmd</span> <span class=o>*</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>,</span> <span class=nx>args</span> <span class=p>[]</span><span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
		<span class=c1>// Do nothing...
</span><span class=c1></span>	<span class=p>},</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>Execute</span><span class=p>()</span> <span class=p>{</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>rootCmd</span><span class=p>.</span><span class=nf>Execute</span><span class=p>();</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintln</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stderr</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
		<span class=nx>os</span><span class=p>.</span><span class=nf>Exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
	<span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h4 id=3-of-8-cmdversiongo>(3 of 8) cmd/version.go</h4><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>cmd</span> <span class=c1>// github.com/bartmika/serialreader-server/cmd/version.go
</span><span class=c1></span>
<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;fmt&#34;</span>

	<span class=s>&#34;github.com/spf13/cobra&#34;</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
	<span class=nx>rootCmd</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=nx>versionCmd</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>var</span> <span class=nx>versionCmd</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>{</span>
	<span class=nx>Use</span><span class=p>:</span>   <span class=s>&#34;version&#34;</span><span class=p>,</span>
	<span class=nx>Short</span><span class=p>:</span> <span class=s>&#34;Print the version number&#34;</span><span class=p>,</span>
	<span class=nx>Long</span><span class=p>:</span>  <span class=s>`Print the current version that this server is on.`</span><span class=p>,</span>
	<span class=nx>Run</span><span class=p>:</span> <span class=kd>func</span><span class=p>(</span><span class=nx>cmd</span> <span class=o>*</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>,</span> <span class=nx>args</span> <span class=p>[]</span><span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;serialreader-server v1.0&#34;</span><span class=p>)</span>
	<span class=p>},</span>
<span class=p>}</span>
</code></pre></div><h4 id=4-of-8-protoserialreaderproto>(4 of 8) proto/serialreader.proto</h4><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=nx>syntax</span> <span class=p>=</span> <span class=s>&#34;proto3&#34;</span><span class=p>;</span> <span class=c1>// github.com/bartmika/serialreader-server/proto/serialreader.proto
</span><span class=c1></span>
<span class=nx>option</span> <span class=nx>go_package</span> <span class=p>=</span> <span class=s>&#34;github.com/bartmika/serialreader-server&#34;</span><span class=p>;</span>

<span class=kn>package</span> <span class=nx>proto</span><span class=p>;</span>


<span class=nx>service</span> <span class=nx>SerialReader</span> <span class=p>{</span>
    <span class=nx>rpc</span> <span class=nf>SayHello</span> <span class=p>(</span><span class=nx>HelloRequest</span><span class=p>)</span> <span class=nf>returns</span> <span class=p>(</span><span class=nx>HelloReply</span><span class=p>)</span> <span class=p>{}</span>
<span class=p>}</span>

<span class=c1>// --- HELLO ENDPOINT ---
</span><span class=c1></span>
<span class=c1>// The request message containing the user&#39;s name.
</span><span class=c1></span><span class=nx>message</span> <span class=nx>HelloRequest</span> <span class=p>{</span>
    <span class=kt>string</span> <span class=nx>name</span> <span class=p>=</span> <span class=mi>1</span><span class=p>;</span>
<span class=p>}</span>

<span class=c1>// The response message containing the greetings
</span><span class=c1></span><span class=nx>message</span> <span class=nx>HelloReply</span> <span class=p>{</span>
    <span class=kt>string</span> <span class=nx>message</span> <span class=p>=</span> <span class=mi>1</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><h4 id=5-of-8-internalservergo>(5 of 8) internal/server.go</h4><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>internal</span> <span class=c1>// github.com/bartmika/serialreader-server/internal/server.go
</span><span class=c1></span>
<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;fmt&#34;</span>
	<span class=s>&#34;log&#34;</span>
	<span class=s>&#34;net&#34;</span>

	<span class=s>&#34;google.golang.org/grpc&#34;</span>

	<span class=nx>pb</span> <span class=s>&#34;github.com/bartmika/serialreader-server/proto&#34;</span>
<span class=p>)</span>

<span class=kd>type</span> <span class=nx>SerialReaderServer</span> <span class=kd>struct</span> <span class=p>{</span>
	<span class=nx>port</span>               <span class=kt>int</span>
	<span class=nx>grpcServer</span>         <span class=o>*</span><span class=nx>grpc</span><span class=p>.</span><span class=nx>Server</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>New</span><span class=p>(</span><span class=nx>port</span> <span class=kt>int</span><span class=p>)</span> <span class=o>*</span><span class=nx>SerialReaderServer</span> <span class=p>{</span>
	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>SerialReaderServer</span><span class=p>{</span>
		<span class=nx>port</span><span class=p>:</span>               <span class=nx>port</span><span class=p>,</span>
		<span class=nx>grpcServer</span><span class=p>:</span>         <span class=kc>nil</span><span class=p>,</span>
	<span class=p>}</span>
<span class=p>}</span>

<span class=c1>// Function will consume the main runtime loop and run the business logic
</span><span class=c1>// of the application.
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>SerialReaderServer</span><span class=p>)</span> <span class=nf>RunMainRuntimeLoop</span><span class=p>()</span> <span class=p>{</span>
	<span class=c1>// Open a TCP server to the specified localhost and environment variable
</span><span class=c1></span>	<span class=c1>// specified port number.
</span><span class=c1></span>	<span class=nx>lis</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>net</span><span class=p>.</span><span class=nf>Listen</span><span class=p>(</span><span class=s>&#34;tcp&#34;</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;:%v&#34;</span><span class=p>,</span> <span class=nx>s</span><span class=p>.</span><span class=nx>port</span><span class=p>))</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed to listen: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>

	<span class=c1>// Initialize our gRPC server using our TCP server.
</span><span class=c1></span>	<span class=nx>grpcServer</span> <span class=o>:=</span> <span class=nx>grpc</span><span class=p>.</span><span class=nf>NewServer</span><span class=p>()</span>

	<span class=c1>// Save reference to our application state.
</span><span class=c1></span>	<span class=nx>s</span><span class=p>.</span><span class=nx>grpcServer</span> <span class=p>=</span> <span class=nx>grpcServer</span>

	<span class=c1>// For debugging purposes only.
</span><span class=c1></span>	<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;gRPC server is running.&#34;</span><span class=p>)</span>

	<span class=c1>// Block the main runtime loop for accepting and processing gRPC requests.
</span><span class=c1></span>	<span class=nx>pb</span><span class=p>.</span><span class=nf>RegisterSerialReaderServer</span><span class=p>(</span><span class=nx>grpcServer</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>SerialReaderServerImpl</span><span class=p>{</span>
		<span class=c1>// DEVELOPERS NOTE:
</span><span class=c1></span>		<span class=c1>// We want to attach to every gRPC call the following variables...
</span><span class=c1></span>		<span class=c1>// ...
</span><span class=c1></span>	<span class=p>})</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>grpcServer</span><span class=p>.</span><span class=nf>Serve</span><span class=p>(</span><span class=nx>lis</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed to serve: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>
<span class=p>}</span>

<span class=c1>// Function will tell the application to stop the main runtime loop when
</span><span class=c1>// the process has been finished.
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>SerialReaderServer</span><span class=p>)</span> <span class=nf>StopMainRuntimeLoop</span><span class=p>()</span> <span class=p>{</span>
	<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Starting graceful shutdown now...&#34;</span><span class=p>)</span>

	<span class=c1>// Finish any RPC communication taking place at the moment before
</span><span class=c1></span>	<span class=c1>// shutting down the gRPC server.
</span><span class=c1></span>	<span class=nx>s</span><span class=p>.</span><span class=nx>grpcServer</span><span class=p>.</span><span class=nf>GracefulStop</span><span class=p>()</span>
<span class=p>}</span>
</code></pre></div><h4 id=6-of-8-internalserver_implgo>(6 of 8) internal/server_impl.go</h4><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>internal</span> <span class=c1>// github.com/bartmika/serialreader-server/internal/server_impl.go
</span><span class=c1></span>
<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;context&#34;</span>
	<span class=s>&#34;log&#34;</span>

	<span class=nx>pb</span> <span class=s>&#34;github.com/bartmika/serialreader-server/proto&#34;</span>
<span class=p>)</span>

<span class=kd>type</span> <span class=nx>SerialReaderServerImpl</span> <span class=kd>struct</span> <span class=p>{</span>
	<span class=nx>pb</span><span class=p>.</span><span class=nx>SerialReaderServer</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>SerialReaderServerImpl</span><span class=p>)</span> <span class=nf>SayHello</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>in</span> <span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>HelloRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>HelloReply</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Received: %v&#34;</span><span class=p>,</span> <span class=nx>in</span><span class=p>.</span><span class=nf>GetName</span><span class=p>())</span>
	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>pb</span><span class=p>.</span><span class=nx>HelloReply</span><span class=p>{</span><span class=nx>Message</span><span class=p>:</span> <span class=s>&#34;Hello &#34;</span> <span class=o>+</span> <span class=nx>in</span><span class=p>.</span><span class=nf>GetName</span><span class=p>()},</span> <span class=kc>nil</span>
<span class=p>}</span>
</code></pre></div><h4 id=7-of-8-cmdservego>(7 of 8) cmd/serve.go</h4><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>cmd</span> <span class=c1>// github.com/bartmika/serialreader-server/cmd/serve.go
</span><span class=c1></span>
<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;os&#34;</span>
	<span class=s>&#34;os/signal&#34;</span>
	<span class=s>&#34;syscall&#34;</span>

	<span class=s>&#34;github.com/spf13/cobra&#34;</span>

	<span class=nx>server</span> <span class=s>&#34;github.com/bartmika/serialreader-server/internal&#34;</span>
<span class=p>)</span>

<span class=kd>var</span> <span class=p>(</span>
	<span class=nx>port</span>                     <span class=kt>int</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
	<span class=c1>// The following are optional and will have defaults placed when missing.
</span><span class=c1></span>	<span class=nx>serveCmd</span><span class=p>.</span><span class=nf>Flags</span><span class=p>().</span><span class=nf>IntVarP</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>port</span><span class=p>,</span> <span class=s>&#34;port&#34;</span><span class=p>,</span> <span class=s>&#34;p&#34;</span><span class=p>,</span> <span class=mi>50051</span><span class=p>,</span> <span class=s>&#34;The port to run this server on&#34;</span><span class=p>)</span>

	<span class=c1>// Make this sub-command part of our application.
</span><span class=c1></span>	<span class=nx>rootCmd</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=nx>serveCmd</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>doServe</span><span class=p>()</span> <span class=p>{</span>
	<span class=c1>// Setup our server.
</span><span class=c1></span>	<span class=nx>server</span> <span class=o>:=</span> <span class=nx>server</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>port</span><span class=p>)</span>

	<span class=c1>// DEVELOPERS CODE:
</span><span class=c1></span>	<span class=c1>// The following code will create an anonymous goroutine which will have a
</span><span class=c1></span>	<span class=c1>// blocking chan `sigs`. This blocking chan will only unblock when the
</span><span class=c1></span>	<span class=c1>// golang app receives a termination command; therfore the anyomous
</span><span class=c1></span>	<span class=c1>// goroutine will run and terminate our running application.
</span><span class=c1></span>	<span class=c1>//
</span><span class=c1></span>	<span class=c1>// Special Thanks:
</span><span class=c1></span>	<span class=c1>// (1) https://gobyexample.com/signals
</span><span class=c1></span>	<span class=c1>// (2) https://guzalexander.com/2017/05/31/gracefully-exit-server-in-go.html
</span><span class=c1></span>	<span class=c1>//
</span><span class=c1></span>	<span class=nx>sigs</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=nx>os</span><span class=p>.</span><span class=nx>Signal</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
	<span class=nx>signal</span><span class=p>.</span><span class=nf>Notify</span><span class=p>(</span><span class=nx>sigs</span><span class=p>,</span> <span class=nx>syscall</span><span class=p>.</span><span class=nx>SIGINT</span><span class=p>,</span> <span class=nx>syscall</span><span class=p>.</span><span class=nx>SIGTERM</span><span class=p>)</span>
	<span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
		<span class=o>&lt;-</span><span class=nx>sigs</span> <span class=c1>// Block execution until signal from terminal gets triggered here.
</span><span class=c1></span>		<span class=nx>server</span><span class=p>.</span><span class=nf>StopMainRuntimeLoop</span><span class=p>()</span>
	<span class=p>}()</span>
	<span class=nx>server</span><span class=p>.</span><span class=nf>RunMainRuntimeLoop</span><span class=p>()</span>
<span class=p>}</span>

<span class=kd>var</span> <span class=nx>serveCmd</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>{</span>
	<span class=nx>Use</span><span class=p>:</span>   <span class=s>&#34;serve&#34;</span><span class=p>,</span>
	<span class=nx>Short</span><span class=p>:</span> <span class=s>&#34;Run the gRPC server&#34;</span><span class=p>,</span>
	<span class=nx>Long</span><span class=p>:</span>  <span class=s>`Run the gRPC server to allow other services to access the serial reader`</span><span class=p>,</span>
	<span class=nx>Run</span><span class=p>:</span> <span class=kd>func</span><span class=p>(</span><span class=nx>cmd</span> <span class=o>*</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>,</span> <span class=nx>args</span> <span class=p>[]</span><span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
		<span class=nf>doServe</span><span class=p>()</span>
	<span class=p>},</span>
<span class=p>}</span>
</code></pre></div><h4 id=8-of-8-cmdhellogo>(8 of 8) cmd/hello.go</h4><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>cmd</span> <span class=c1>// github.com/bartmika/serialreader-server/cmd/hello.go
</span><span class=c1></span>
<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;context&#34;</span>
	<span class=s>&#34;fmt&#34;</span>
	<span class=s>&#34;log&#34;</span>
	<span class=s>&#34;time&#34;</span>

	<span class=s>&#34;github.com/spf13/cobra&#34;</span>
	<span class=s>&#34;google.golang.org/grpc&#34;</span>
	<span class=c1>// &#34;google.golang.org/grpc/credentials&#34;
</span><span class=c1></span>
	<span class=nx>pb</span> <span class=s>&#34;github.com/bartmika/serialreader-server/proto&#34;</span>
<span class=p>)</span>

<span class=kd>var</span> <span class=p>(</span>
	<span class=nx>name</span> <span class=kt>string</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
	<span class=c1>// The following are required.
</span><span class=c1></span>	<span class=nx>helloCmd</span><span class=p>.</span><span class=nf>Flags</span><span class=p>().</span><span class=nf>StringVarP</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>name</span><span class=p>,</span> <span class=s>&#34;name&#34;</span><span class=p>,</span> <span class=s>&#34;n&#34;</span><span class=p>,</span> <span class=s>&#34;Anonymous&#34;</span><span class=p>,</span> <span class=s>&#34;The name to send the server.&#34;</span><span class=p>)</span>
	<span class=nx>helloCmd</span><span class=p>.</span><span class=nf>MarkFlagRequired</span><span class=p>(</span><span class=s>&#34;name&#34;</span><span class=p>)</span>

	<span class=c1>// The following are optional and will have defaults placed when missing.
</span><span class=c1></span>	<span class=nx>helloCmd</span><span class=p>.</span><span class=nf>Flags</span><span class=p>().</span><span class=nf>IntVarP</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>port</span><span class=p>,</span> <span class=s>&#34;port&#34;</span><span class=p>,</span> <span class=s>&#34;p&#34;</span><span class=p>,</span> <span class=mi>50051</span><span class=p>,</span> <span class=s>&#34;The port of our server.&#34;</span><span class=p>)</span>
	<span class=nx>rootCmd</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=nx>helloCmd</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>doHello</span><span class=p>()</span> <span class=p>{</span>
	<span class=c1>// Set up a direct connection to the gRPC server.
</span><span class=c1></span>	<span class=nx>conn</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>grpc</span><span class=p>.</span><span class=nf>Dial</span><span class=p>(</span>
		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;:%v&#34;</span><span class=p>,</span> <span class=nx>port</span><span class=p>),</span>
		<span class=nx>grpc</span><span class=p>.</span><span class=nf>WithInsecure</span><span class=p>(),</span>
		<span class=nx>grpc</span><span class=p>.</span><span class=nf>WithBlock</span><span class=p>(),</span>
	<span class=p>)</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;did not connect: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>

	<span class=c1>// Set up our protocol buffer interface.
</span><span class=c1></span>	<span class=nx>client</span> <span class=o>:=</span> <span class=nx>pb</span><span class=p>.</span><span class=nf>NewSerialReaderClient</span><span class=p>(</span><span class=nx>conn</span><span class=p>)</span>
	<span class=k>defer</span> <span class=nx>conn</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>

	<span class=nx>ctx</span><span class=p>,</span> <span class=nx>cancel</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>WithTimeout</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
	<span class=k>defer</span> <span class=nf>cancel</span><span class=p>()</span>

	<span class=c1>// Perform our gRPC request.
</span><span class=c1></span>	<span class=nx>r</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>SayHello</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>pb</span><span class=p>.</span><span class=nx>HelloRequest</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span> <span class=nx>name</span><span class=p>})</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;could not greet: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>

	<span class=c1>// Print out the gRPC response.
</span><span class=c1></span>	<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Server Response: %s&#34;</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nf>GetMessage</span><span class=p>())</span>
<span class=p>}</span>

<span class=kd>var</span> <span class=nx>helloCmd</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>{</span>
	<span class=nx>Use</span><span class=p>:</span>   <span class=s>&#34;hello&#34;</span><span class=p>,</span>
	<span class=nx>Short</span><span class=p>:</span> <span class=s>&#34;Send hello message to gRPC server&#34;</span><span class=p>,</span>
	<span class=nx>Long</span><span class=p>:</span>  <span class=s>`Connect to the gRPC server and send a hello message. Command used to test out that the server is running.`</span><span class=p>,</span>
	<span class=nx>Run</span><span class=p>:</span> <span class=kd>func</span><span class=p>(</span><span class=nx>cmd</span> <span class=o>*</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>,</span> <span class=nx>args</span> <span class=p>[]</span><span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
		<span class=nf>doHello</span><span class=p>()</span>
	<span class=p>},</span>
<span class=p>}</span>
</code></pre></div><h2 id=usage-of-the-basic-grpc-server>Usage of the Basic gRPC Server</h2><p>In your primary <strong>terminal</strong>, please run the server by entering the following <strong>command</strong>:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>go run main.go serve</code></pre></div><p>You should see something like this:</p><p><img src=/img/2021/07-09/a1.png alt></p><p>If you see this then you have successfully setup the basic gRPC server. In a another <strong>terminal</strong> window or tab, please execute the following <strong>command</strong> to verify our server is working.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>go run main.go hello --name<span class=o>=</span><span class=s2>&#34;Bartlomiej&#34;</span></code></pre></div><p>You should see something like this:</p><p><img src=/img/2021/07-09/a2.png alt></p><p>Good stuff, our server works! Now let&rsquo;s build a gRPC service definition over our serial reader.</p><h2 id=integrate-the-sparkfun-weather-shield-reader>Integrate the SparkFun Weather Shield Reader</h2><p><em>Before we begin, I am assuming you have successfully read through our <a href=/post/2021/how-to-read-data-from-a-sparkfun-weather-shield-dev-13956-in-golang/>previous article</a> before continuing. If you did not the next steps will note make sense.</em></p><p>Take a look at the following folder structure and create the necessary empty files:</p><h4 id=project-hierarchy-1>Project Hierarchy</h4><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>📁 serialreader-server
│   📄 main.go
│
└───📁 cmd
<span class=p>|</span>   <span class=p>|</span>
<span class=p>|</span>   └───📄 get_data.go <span class=o>(</span>*<span class=o>)</span>
<span class=p>|</span>       📄 hello.go
<span class=p>|</span>       📄 root.go
<span class=p>|</span>       📄 serve.go
<span class=p>|</span>       📄 version.go
<span class=p>|</span>
└───📁 internal
<span class=p>|</span>   <span class=p>|</span>
<span class=p>|</span>   └───📄 arduino_reader.go <span class=o>(</span>*<span class=o>)</span>
<span class=p>|</span>       📄 server_impl.go
<span class=p>|</span>       📄 server.go
<span class=p>|</span>
└───📁 proto
    <span class=p>|</span>
    └───📄 serialreader.proto</code></pre></div><p>Notice the asterisks (*), those are the new files you will need to create.</p><p>Please copy and paste the following files. It&rsquo;s important to note you need to override the entire file when pasting!</p><h4 id=1-of-6-protoserialreaderproto>(1 of 6) proto/serialreader.proto</h4><div class=highlight><pre class=chroma><code class=language-proto data-lang=proto><span class=n>syntax</span> <span class=o>=</span> <span class=s>&#34;proto3&#34;</span><span class=p>;</span> <span class=c1>// github.com/bartmika/serialreader-server/proto/serialreader.proto
</span><span class=c1></span><span class=err>
</span><span class=err></span><span class=k>option</span> <span class=n>go_package</span> <span class=o>=</span> <span class=s>&#34;github.com/bartmika/serialreader-server&#34;</span><span class=p>;</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=kn>package</span> <span class=nn>proto</span><span class=p>;</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>import</span> <span class=s>&#34;google/protobuf/timestamp.proto&#34;</span><span class=p>;</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=kd>service</span> <span class=n>SerialReader</span> <span class=p>{</span><span class=err>
</span><span class=err></span>    <span class=k>rpc</span> <span class=n>SayHello</span> <span class=p>(</span><span class=n>HelloRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>HelloReply</span><span class=p>)</span> <span class=p>{}</span><span class=err>
</span><span class=err></span>    <span class=k>rpc</span> <span class=n>GetSparkFunWeatherShieldData</span> <span class=p>(</span><span class=n>GetTimeSeriesData</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>SparkFunWeatherShieldTimeSeriesData</span><span class=p>)</span> <span class=p>{}</span><span class=err>
</span><span class=err></span><span class=p>}</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c1>// --- HELLO ENDPOINT ---
</span><span class=c1></span><span class=err>
</span><span class=err></span><span class=c1>// The request message containing the user&#39;s name.
</span><span class=c1></span><span class=kd>message</span> <span class=nc>HelloRequest</span> <span class=p>{</span><span class=err>
</span><span class=err></span>    <span class=kt>string</span> <span class=n>name</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span><span class=err></span><span class=p>}</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c1>// The response message containing the greetings
</span><span class=c1></span><span class=kd>message</span> <span class=nc>HelloReply</span> <span class=p>{</span><span class=err>
</span><span class=err></span>    <span class=kt>string</span> <span class=kd>message</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span><span class=err></span><span class=p>}</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c1>// --- POLLING ENDPOINT ---
</span><span class=c1></span><span class=err>
</span><span class=err></span><span class=kd>message</span> <span class=nc>GetTimeSeriesData</span> <span class=p>{}</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=kd>message</span> <span class=nc>SparkFunWeatherShieldTimeSeriesData</span> <span class=p>{</span><span class=err>
</span><span class=err></span>    <span class=kt>bool</span> <span class=n>status</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=n>google.protobuf.Timestamp</span> <span class=n>timestamp</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>float</span> <span class=n>humidityValue</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>string</span> <span class=n>humidityUnit</span> <span class=o>=</span> <span class=mi>4</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>float</span> <span class=n>temperatureValue</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>string</span> <span class=n>temperatureUnit</span> <span class=o>=</span> <span class=mi>6</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>float</span> <span class=n>pressureValue</span> <span class=o>=</span> <span class=mi>7</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>string</span> <span class=n>pressureUnit</span> <span class=o>=</span> <span class=mi>8</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>float</span> <span class=n>temperatureBackupValue</span> <span class=o>=</span> <span class=mi>9</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>string</span> <span class=n>temperatureBackupUnit</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>float</span> <span class=n>altitudeValue</span> <span class=o>=</span> <span class=mi>11</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>string</span> <span class=n>altitudeUnit</span> <span class=o>=</span> <span class=mi>12</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>float</span> <span class=n>illuminanceValue</span> <span class=o>=</span> <span class=mi>13</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>string</span> <span class=n>illuminanceUnit</span> <span class=o>=</span> <span class=mi>14</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>float</span> <span class=n>soilMoistureValue</span> <span class=o>=</span> <span class=mi>15</span><span class=p>;</span><span class=err>
</span><span class=err></span>    <span class=kt>string</span> <span class=n>soilMoistureUnit</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span><span class=err>
</span><span class=err></span><span class=p>}</span></code></pre></div><h4 id=2-of-6-internalarduino_readergo>(2 of 6) internal/arduino_reader.go</h4><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>internal</span> <span class=c1>// github.com/bartmika/serialreader-server/internal/arduino_reader.go
</span><span class=c1></span>
<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;fmt&#34;</span>
	<span class=s>&#34;encoding/json&#34;</span>
	<span class=s>&#34;log&#34;</span>
	<span class=s>&#34;time&#34;</span>

	<span class=s>&#34;github.com/tarm/serial&#34;</span>
<span class=p>)</span>

<span class=kd>const</span> <span class=nx>RX_BYTE</span> <span class=p>=</span> <span class=s>&#34;1&#34;</span>

<span class=c1>// The time-series data structure used to store all the data that will be
</span><span class=c1>// returned by the `SparkFun Weather Shield` Arduino device.
</span><span class=c1></span><span class=kd>type</span> <span class=nx>TimeSeriesData</span> <span class=kd>struct</span> <span class=p>{</span>
	<span class=nx>Status</span>                     <span class=kt>string</span>  <span class=s>`json:&#34;status,omitempty&#34;`</span>
	<span class=nx>Runtime</span>                    <span class=kt>int</span>     <span class=s>`json:&#34;runtime,omitempty&#34;`</span>
	<span class=nx>Id</span>                         <span class=kt>int</span>     <span class=s>`json:&#34;id,omitempty&#34;`</span>
	<span class=nx>HumidityValue</span>              <span class=kt>float32</span> <span class=s>`json:&#34;humidity_value,omitempty&#34;`</span>
	<span class=nx>HumidityUnit</span>               <span class=kt>string</span>  <span class=s>`json:&#34;humidity_unit,omitempty&#34;`</span>
	<span class=nx>TemperatureValue</span>           <span class=kt>float32</span> <span class=s>`json:&#34;temperature_primary_value,omitempty&#34;`</span>
	<span class=nx>TemperatureUnit</span>            <span class=kt>string</span>  <span class=s>`json:&#34;temperature_primary_unit,omitempty&#34;`</span>
	<span class=nx>PressureValue</span>              <span class=kt>float32</span> <span class=s>`json:&#34;pressure_value,omitempty&#34;`</span>
	<span class=nx>PressureUnit</span>               <span class=kt>string</span>  <span class=s>`json:&#34;pressure_unit,omitempty&#34;`</span>
	<span class=nx>TemperatureBackupValue</span>     <span class=kt>float32</span> <span class=s>`json:&#34;temperature_secondary_value,omitempty&#34;`</span>
	<span class=nx>TemperatureBackupUnit</span>      <span class=kt>string</span>  <span class=s>`json:&#34;temperature_secondary_unit,omitempty&#34;`</span>
	<span class=nx>AltitudeValue</span>              <span class=kt>float32</span> <span class=s>`json:&#34;altitude_value,omitempty&#34;`</span>
	<span class=nx>AltitudeUnit</span>               <span class=kt>string</span>  <span class=s>`json:&#34;altitude_unit,omitempty&#34;`</span>
	<span class=nx>IlluminanceValue</span>           <span class=kt>float32</span> <span class=s>`json:&#34;illuminance_value,omitempty&#34;`</span>
	<span class=nx>IlluminanceUnit</span>            <span class=kt>string</span>  <span class=s>`json:&#34;illuminance_unit,omitempty&#34;`</span>
	<span class=nx>Timestamp</span>                  <span class=kt>int64</span>   <span class=s>`json:&#34;timestamp,omitempty&#34;`</span>
<span class=p>}</span>

<span class=c1>// The abstraction of the `SparkFun Weather Shield` reader.
</span><span class=c1></span><span class=kd>type</span> <span class=nx>ArduinoReader</span> <span class=kd>struct</span> <span class=p>{</span>
	<span class=nx>serialPort</span> <span class=o>*</span><span class=nx>serial</span><span class=p>.</span><span class=nx>Port</span>
<span class=p>}</span>

<span class=c1>// Constructor used to intialize the serial reader designed to communicate
</span><span class=c1>// with Arduino configured for the `SparkFun Weather Shield` settings.
</span><span class=c1></span><span class=kd>func</span> <span class=nf>NewArduinoReader</span><span class=p>(</span><span class=nx>devicePath</span> <span class=kt>string</span><span class=p>)</span> <span class=o>*</span><span class=nx>ArduinoReader</span> <span class=p>{</span>
	<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;READER: Attempting to connect Arduino device...&#34;</span><span class=p>)</span>
	<span class=nx>c</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>serial</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span><span class=nx>Name</span><span class=p>:</span> <span class=nx>devicePath</span><span class=p>,</span> <span class=nx>Baud</span><span class=p>:</span> <span class=mi>9600</span><span class=p>}</span>
	<span class=nx>s</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>serial</span><span class=p>.</span><span class=nf>OpenPort</span><span class=p>(</span><span class=nx>c</span><span class=p>)</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>

	<span class=c1>// DEVELOPERS NOTE:
</span><span class=c1></span>	<span class=c1>// The following code will warm up the Arduino device before we are
</span><span class=c1></span>	<span class=c1>// able to make calls to the external sensors.
</span><span class=c1></span>	<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;READER: Waiting for Arduino external sensors to warm up&#34;</span><span class=p>)</span>
	<span class=nx>ar</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>ArduinoReader</span><span class=p>{</span><span class=nx>serialPort</span><span class=p>:</span> <span class=nx>s</span><span class=p>}</span>
	<span class=nx>ar</span><span class=p>.</span><span class=nf>GetSparkFunWeatherShieldData</span><span class=p>()</span>
	<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>5</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
	<span class=nx>ar</span><span class=p>.</span><span class=nf>GetSparkFunWeatherShieldData</span><span class=p>()</span>
	<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>5</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
	<span class=k>return</span> <span class=nx>ar</span>
<span class=p>}</span>

<span class=c1>// Function returns the JSON data of the instrument readings from our Arduino
</span><span class=c1>// device configured for the `SparkFun Weather Shield` settings.
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>ar</span> <span class=o>*</span><span class=nx>ArduinoReader</span><span class=p>)</span> <span class=nf>GetSparkFunWeatherShieldData</span><span class=p>()</span> <span class=o>*</span><span class=nx>TimeSeriesData</span> <span class=p>{</span>
	<span class=c1>// DEVELOPERS NOTE:
</span><span class=c1></span>	<span class=c1>// (1) The external device (Arduino) is setup to standby idle until it
</span><span class=c1></span>	<span class=c1>//     receives a poll request from this code, once a poll request has
</span><span class=c1></span>	<span class=c1>//     been submitted then all the sensors get polled and their data is
</span><span class=c1></span>	<span class=c1>//     returned.
</span><span class=c1></span>	<span class=c1>// (2) Please look at the following code to understand how the external
</span><span class=c1></span>	<span class=c1>//     device works in: &lt;TODO ADD&gt;
</span><span class=c1></span>	<span class=c1>//
</span><span class=c1></span>	<span class=c1>// (3) The reason for design is as follows:
</span><span class=c1></span>	<span class=c1>//     (a) The external device does not have a real-time clock
</span><span class=c1></span>	<span class=c1>//     (b) We don&#39;t want to add any real-time clock shields because
</span><span class=c1></span>	<span class=c1>//         extra hardware means it costs more.
</span><span class=c1></span>	<span class=c1>//     (c) We don&#39;t want to write complicated code of synching time
</span><span class=c1></span>	<span class=c1>//         from this code because it will make the code complicated.
</span><span class=c1></span>	<span class=c1>//     (d) Therefore we chose to make sensor polling be event based
</span><span class=c1></span>	<span class=c1>//         and this code needs to send a &#34;poll request&#34;.
</span><span class=c1></span>
	<span class=c1>// STEP 1:
</span><span class=c1></span>	<span class=c1>// We need to send a single byte to the external device (Arduino) which
</span><span class=c1></span>	<span class=c1>// will trigger a polling event on all the sensors.
</span><span class=c1></span>	<span class=nx>n</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>ar</span><span class=p>.</span><span class=nx>serialPort</span><span class=p>.</span><span class=nf>Write</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>RX_BYTE</span><span class=p>))</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>

	<span class=c1>// STEP 2:
</span><span class=c1></span>	<span class=c1>// The external device will poll the device, we need to make our main
</span><span class=c1></span>	<span class=c1>// runtime loop to be blocked so we wait until the device finishes and
</span><span class=c1></span>	<span class=c1>// returns all the sensor measurements.
</span><span class=c1></span>	<span class=nx>buf</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>byte</span><span class=p>,</span> <span class=mi>1028</span><span class=p>)</span>
	<span class=nx>n</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>ar</span><span class=p>.</span><span class=nx>serialPort</span><span class=p>.</span><span class=nf>Read</span><span class=p>(</span><span class=nx>buf</span><span class=p>)</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>

	<span class=c1>// STEP 3:
</span><span class=c1></span>	<span class=c1>// Check to see if ANY data was returned from the external device, if
</span><span class=c1></span>	<span class=c1>// there was then we load up the string into a JSON object.
</span><span class=c1></span>	<span class=kd>var</span> <span class=nx>tsd</span> <span class=nx>TimeSeriesData</span>
	<span class=nx>err</span> <span class=p>=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>Unmarshal</span><span class=p>(</span><span class=nx>buf</span><span class=p>[:</span><span class=nx>n</span><span class=p>],</span> <span class=o>&amp;</span><span class=nx>tsd</span><span class=p>)</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=k>return</span> <span class=kc>nil</span>
	<span class=p>}</span>
	<span class=nx>tsd</span><span class=p>.</span><span class=nx>Timestamp</span> <span class=p>=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>Unix</span><span class=p>()</span>
	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>tsd</span>
<span class=p>}</span>

<span class=c1>// Function used to print to the console the time series data.
</span><span class=c1></span><span class=kd>func</span> <span class=nf>PrettyPrintTimeSeriesData</span><span class=p>(</span><span class=nx>tsd</span> <span class=o>*</span><span class=nx>TimeSeriesData</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Status: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>Status</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Runtime: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>Runtime</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Status: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>Id</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;HumidityValue: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>HumidityValue</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;HumidityUnit: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>HumidityUnit</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;TemperatureValue: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>TemperatureValue</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;TemperatureUnit: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>TemperatureUnit</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;PressureValue: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>PressureValue</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;PressureUnit: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>PressureUnit</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;TemperatureBackupValue: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>TemperatureBackupValue</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;TemperatureBackupUnit: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>TemperatureBackupUnit</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;AltitudeValue: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>AltitudeValue</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;AltitudeUnit: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>AltitudeUnit</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;IlluminanceValue: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>IlluminanceValue</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;IlluminanceUnit: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>IlluminanceUnit</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Timestamp: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>Timestamp</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><h4 id=3-of-6-internalservergo>(3 of 6) internal/server.go</h4><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>internal</span> <span class=c1>// github.com/bartmika/serialreader-server/internal/server.go
</span><span class=c1></span>
<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;fmt&#34;</span>
	<span class=s>&#34;log&#34;</span>
	<span class=s>&#34;net&#34;</span>

	<span class=s>&#34;google.golang.org/grpc&#34;</span>

	<span class=nx>pb</span> <span class=s>&#34;github.com/bartmika/serialreader-server/proto&#34;</span>
<span class=p>)</span>

<span class=kd>type</span> <span class=nx>SerialReaderServer</span> <span class=kd>struct</span> <span class=p>{</span>
	<span class=nx>port</span>               <span class=kt>int</span>
	<span class=nx>arduinoDevicePath</span>  <span class=kt>string</span>
	<span class=nx>arduinoReader</span>             <span class=o>*</span><span class=nx>ArduinoReader</span>
	<span class=nx>grpcServer</span>         <span class=o>*</span><span class=nx>grpc</span><span class=p>.</span><span class=nx>Server</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>New</span><span class=p>(</span><span class=nx>arduinoDevicePath</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>port</span> <span class=kt>int</span><span class=p>)</span> <span class=o>*</span><span class=nx>SerialReaderServer</span> <span class=p>{</span>
	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>SerialReaderServer</span><span class=p>{</span>
		<span class=nx>port</span><span class=p>:</span>               <span class=nx>port</span><span class=p>,</span>
		<span class=nx>arduinoDevicePath</span><span class=p>:</span>  <span class=nx>arduinoDevicePath</span><span class=p>,</span>
		<span class=nx>arduinoReader</span><span class=p>:</span>             <span class=kc>nil</span><span class=p>,</span>
		<span class=nx>grpcServer</span><span class=p>:</span>         <span class=kc>nil</span><span class=p>,</span>
	<span class=p>}</span>
<span class=p>}</span>

<span class=c1>// Function will consume the main runtime loop and run the business logic
</span><span class=c1>// of the application.
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>SerialReaderServer</span><span class=p>)</span> <span class=nf>RunMainRuntimeLoop</span><span class=p>()</span> <span class=p>{</span>
	<span class=c1>// Open a TCP server to the specified localhost and environment variable
</span><span class=c1></span>	<span class=c1>// specified port number.
</span><span class=c1></span>	<span class=nx>lis</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>net</span><span class=p>.</span><span class=nf>Listen</span><span class=p>(</span><span class=s>&#34;tcp&#34;</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;:%v&#34;</span><span class=p>,</span> <span class=nx>s</span><span class=p>.</span><span class=nx>port</span><span class=p>))</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed to listen: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>

	<span class=c1>// Establish our device connection.
</span><span class=c1></span>	<span class=nx>arduinoReader</span> <span class=o>:=</span> <span class=nf>NewArduinoReader</span><span class=p>(</span><span class=nx>s</span><span class=p>.</span><span class=nx>arduinoDevicePath</span><span class=p>)</span>

	<span class=c1>// Initialize our gRPC server using our TCP server.
</span><span class=c1></span>	<span class=nx>grpcServer</span> <span class=o>:=</span> <span class=nx>grpc</span><span class=p>.</span><span class=nf>NewServer</span><span class=p>()</span>

	<span class=c1>// Save reference to our application state.
</span><span class=c1></span>	<span class=nx>s</span><span class=p>.</span><span class=nx>grpcServer</span> <span class=p>=</span> <span class=nx>grpcServer</span>
	<span class=nx>s</span><span class=p>.</span><span class=nx>arduinoReader</span> <span class=p>=</span> <span class=nx>arduinoReader</span>

	<span class=c1>// For debugging purposes only.
</span><span class=c1></span>	<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;gRPC server is running.&#34;</span><span class=p>)</span>

	<span class=c1>// Block the main runtime loop for accepting and processing gRPC requests.
</span><span class=c1></span>	<span class=nx>pb</span><span class=p>.</span><span class=nf>RegisterSerialReaderServer</span><span class=p>(</span><span class=nx>grpcServer</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>SerialReaderServerImpl</span><span class=p>{</span>
		<span class=c1>// DEVELOPERS NOTE:
</span><span class=c1></span>		<span class=c1>// We want to attach to every gRPC call the following variables...
</span><span class=c1></span>		<span class=nx>arduinoReader</span><span class=p>:</span> <span class=nx>arduinoReader</span><span class=p>,</span>
	<span class=p>})</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>grpcServer</span><span class=p>.</span><span class=nf>Serve</span><span class=p>(</span><span class=nx>lis</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed to serve: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>
<span class=p>}</span>

<span class=c1>// Function will tell the application to stop the main runtime loop when
</span><span class=c1>// the process has been finished.
</span><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>SerialReaderServer</span><span class=p>)</span> <span class=nf>StopMainRuntimeLoop</span><span class=p>()</span> <span class=p>{</span>
	<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Starting graceful shutdown now...&#34;</span><span class=p>)</span>

	<span class=nx>s</span><span class=p>.</span><span class=nx>arduinoReader</span> <span class=p>=</span> <span class=kc>nil</span>

	<span class=c1>// Finish any RPC communication taking place at the moment before
</span><span class=c1></span>	<span class=c1>// shutting down the gRPC server.
</span><span class=c1></span>	<span class=nx>s</span><span class=p>.</span><span class=nx>grpcServer</span><span class=p>.</span><span class=nf>GracefulStop</span><span class=p>()</span>
<span class=p>}</span>
</code></pre></div><h4 id=4-of-6-internalserver_implgo>(4 of 6) internal/server_impl.go</h4><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>internal</span> <span class=c1>// github.com/bartmika/serialreader-server/internal/server_impl.go
</span><span class=c1></span>
<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;context&#34;</span>
	<span class=s>&#34;log&#34;</span>

	<span class=s>&#34;github.com/golang/protobuf/ptypes&#34;</span>

	<span class=nx>pb</span> <span class=s>&#34;github.com/bartmika/serialreader-server/proto&#34;</span>
<span class=p>)</span>

<span class=kd>type</span> <span class=nx>SerialReaderServerImpl</span> <span class=kd>struct</span> <span class=p>{</span>
	<span class=nx>arduinoReader</span> <span class=o>*</span><span class=nx>ArduinoReader</span>
	<span class=nx>pb</span><span class=p>.</span><span class=nx>SerialReaderServer</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>SerialReaderServerImpl</span><span class=p>)</span> <span class=nf>SayHello</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>in</span> <span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>HelloRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>HelloReply</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Received: %v&#34;</span><span class=p>,</span> <span class=nx>in</span><span class=p>.</span><span class=nf>GetName</span><span class=p>())</span>
	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>pb</span><span class=p>.</span><span class=nx>HelloReply</span><span class=p>{</span><span class=nx>Message</span><span class=p>:</span> <span class=s>&#34;Hello &#34;</span> <span class=o>+</span> <span class=nx>in</span><span class=p>.</span><span class=nf>GetName</span><span class=p>()},</span> <span class=kc>nil</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>SerialReaderServerImpl</span><span class=p>)</span> <span class=nf>GetSparkFunWeatherShieldData</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>in</span> <span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>GetTimeSeriesData</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>pb</span><span class=p>.</span><span class=nx>SparkFunWeatherShieldTimeSeriesData</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
	<span class=nx>datum</span> <span class=o>:=</span> <span class=nx>s</span><span class=p>.</span><span class=nx>arduinoReader</span><span class=p>.</span><span class=nf>GetSparkFunWeatherShieldData</span><span class=p>()</span>
	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>pb</span><span class=p>.</span><span class=nx>SparkFunWeatherShieldTimeSeriesData</span><span class=p>{</span>
		<span class=nx>Status</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
		<span class=nx>Timestamp</span><span class=p>:</span> <span class=nx>ptypes</span><span class=p>.</span><span class=nf>TimestampNow</span><span class=p>(),</span> <span class=c1>// Note: https://godoc.org/github.com/golang/protobuf/ptypes#Timestamp
</span><span class=c1></span>		<span class=nx>HumidityValue</span><span class=p>:</span> <span class=nx>datum</span><span class=p>.</span><span class=nx>HumidityValue</span><span class=p>,</span>
		<span class=nx>HumidityUnit</span><span class=p>:</span> <span class=nx>datum</span><span class=p>.</span><span class=nx>HumidityUnit</span><span class=p>,</span>
		<span class=nx>TemperatureValue</span><span class=p>:</span> <span class=nx>datum</span><span class=p>.</span><span class=nx>TemperatureValue</span><span class=p>,</span>
		<span class=nx>TemperatureUnit</span><span class=p>:</span> <span class=nx>datum</span><span class=p>.</span><span class=nx>TemperatureUnit</span><span class=p>,</span>
		<span class=nx>PressureValue</span><span class=p>:</span> <span class=nx>datum</span><span class=p>.</span><span class=nx>PressureValue</span><span class=p>,</span>
		<span class=nx>PressureUnit</span><span class=p>:</span> <span class=nx>datum</span><span class=p>.</span><span class=nx>PressureUnit</span><span class=p>,</span>
		<span class=nx>TemperatureBackupValue</span><span class=p>:</span> <span class=nx>datum</span><span class=p>.</span><span class=nx>TemperatureBackupValue</span><span class=p>,</span>
		<span class=nx>TemperatureBackupUnit</span><span class=p>:</span> <span class=nx>datum</span><span class=p>.</span><span class=nx>TemperatureBackupUnit</span><span class=p>,</span>
		<span class=nx>AltitudeValue</span><span class=p>:</span> <span class=nx>datum</span><span class=p>.</span><span class=nx>AltitudeValue</span><span class=p>,</span>
		<span class=nx>AltitudeUnit</span><span class=p>:</span> <span class=nx>datum</span><span class=p>.</span><span class=nx>AltitudeUnit</span><span class=p>,</span>
		<span class=nx>IlluminanceValue</span><span class=p>:</span> <span class=nx>datum</span><span class=p>.</span><span class=nx>IlluminanceValue</span><span class=p>,</span>
		<span class=nx>IlluminanceUnit</span><span class=p>:</span> <span class=nx>datum</span><span class=p>.</span><span class=nx>IlluminanceUnit</span><span class=p>,</span>
	<span class=p>},</span> <span class=kc>nil</span>
<span class=p>}</span>
</code></pre></div><h4 id=5-of-6-cmdservego>(5 of 6) cmd/serve.go</h4><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>cmd</span> <span class=c1>// github.com/bartmika/serialreader-server/cmd/serve.go
</span><span class=c1></span>
<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;os&#34;</span>
	<span class=s>&#34;os/signal&#34;</span>
	<span class=s>&#34;syscall&#34;</span>

	<span class=s>&#34;github.com/spf13/cobra&#34;</span>

	<span class=nx>server</span> <span class=s>&#34;github.com/bartmika/serialreader-server/internal&#34;</span>
<span class=p>)</span>

<span class=kd>var</span> <span class=p>(</span>
	<span class=nx>port</span>                     <span class=kt>int</span>
	<span class=nx>arduinoDevicePath</span>        <span class=kt>string</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
	<span class=c1>// The following are required.
</span><span class=c1></span>	<span class=nx>serveCmd</span><span class=p>.</span><span class=nf>Flags</span><span class=p>().</span><span class=nf>StringVarP</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>arduinoDevicePath</span><span class=p>,</span> <span class=s>&#34;arduino_path&#34;</span><span class=p>,</span> <span class=s>&#34;f&#34;</span><span class=p>,</span> <span class=s>&#34;/dev/cu.usbmodem14201&#34;</span><span class=p>,</span> <span class=s>&#34;The location of the connected arduino device on your computer.&#34;</span><span class=p>)</span>
	<span class=nx>serveCmd</span><span class=p>.</span><span class=nf>MarkFlagRequired</span><span class=p>(</span><span class=s>&#34;arduino_path&#34;</span><span class=p>)</span>

	<span class=c1>// The following are optional and will have defaults placed when missing.
</span><span class=c1></span>	<span class=nx>serveCmd</span><span class=p>.</span><span class=nf>Flags</span><span class=p>().</span><span class=nf>IntVarP</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>port</span><span class=p>,</span> <span class=s>&#34;port&#34;</span><span class=p>,</span> <span class=s>&#34;p&#34;</span><span class=p>,</span> <span class=mi>50051</span><span class=p>,</span> <span class=s>&#34;The port to run this server on&#34;</span><span class=p>)</span>

	<span class=c1>// Make this sub-command part of our application.
</span><span class=c1></span>	<span class=nx>rootCmd</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=nx>serveCmd</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>doServe</span><span class=p>()</span> <span class=p>{</span>
	<span class=c1>// Setup our server.
</span><span class=c1></span>	<span class=nx>server</span> <span class=o>:=</span> <span class=nx>server</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>arduinoDevicePath</span><span class=p>,</span> <span class=nx>port</span><span class=p>)</span>

	<span class=c1>// DEVELOPERS CODE:
</span><span class=c1></span>	<span class=c1>// The following code will create an anonymous goroutine which will have a
</span><span class=c1></span>	<span class=c1>// blocking chan `sigs`. This blocking chan will only unblock when the
</span><span class=c1></span>	<span class=c1>// golang app receives a termination command; therfore the anyomous
</span><span class=c1></span>	<span class=c1>// goroutine will run and terminate our running application.
</span><span class=c1></span>	<span class=c1>//
</span><span class=c1></span>	<span class=c1>// Special Thanks:
</span><span class=c1></span>	<span class=c1>// (1) https://gobyexample.com/signals
</span><span class=c1></span>	<span class=c1>// (2) https://guzalexander.com/2017/05/31/gracefully-exit-server-in-go.html
</span><span class=c1></span>	<span class=c1>//
</span><span class=c1></span>	<span class=nx>sigs</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=nx>os</span><span class=p>.</span><span class=nx>Signal</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
	<span class=nx>signal</span><span class=p>.</span><span class=nf>Notify</span><span class=p>(</span><span class=nx>sigs</span><span class=p>,</span> <span class=nx>syscall</span><span class=p>.</span><span class=nx>SIGINT</span><span class=p>,</span> <span class=nx>syscall</span><span class=p>.</span><span class=nx>SIGTERM</span><span class=p>)</span>
	<span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
		<span class=o>&lt;-</span><span class=nx>sigs</span> <span class=c1>// Block execution until signal from terminal gets triggered here.
</span><span class=c1></span>		<span class=nx>server</span><span class=p>.</span><span class=nf>StopMainRuntimeLoop</span><span class=p>()</span>
	<span class=p>}()</span>
	<span class=nx>server</span><span class=p>.</span><span class=nf>RunMainRuntimeLoop</span><span class=p>()</span>
<span class=p>}</span>

<span class=kd>var</span> <span class=nx>serveCmd</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>{</span>
	<span class=nx>Use</span><span class=p>:</span>   <span class=s>&#34;serve&#34;</span><span class=p>,</span>
	<span class=nx>Short</span><span class=p>:</span> <span class=s>&#34;Run the gRPC server&#34;</span><span class=p>,</span>
	<span class=nx>Long</span><span class=p>:</span>  <span class=s>`Run the gRPC server to allow other services to access the serial reader`</span><span class=p>,</span>
	<span class=nx>Run</span><span class=p>:</span> <span class=kd>func</span><span class=p>(</span><span class=nx>cmd</span> <span class=o>*</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>,</span> <span class=nx>args</span> <span class=p>[]</span><span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
		<span class=nf>doServe</span><span class=p>()</span>
	<span class=p>},</span>
<span class=p>}</span>
</code></pre></div><h4 id=6-of-6-cmdget_datago>(6 of 6) cmd/get_data.go</h4><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>package</span> <span class=nx>cmd</span> <span class=c1>// github.com/bartmika/serialreader-server/cmd/get_data.go
</span><span class=c1></span>
<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;context&#34;</span>
	<span class=s>&#34;fmt&#34;</span>
	<span class=s>&#34;log&#34;</span>
	<span class=s>&#34;time&#34;</span>

	<span class=s>&#34;github.com/spf13/cobra&#34;</span>
	<span class=s>&#34;google.golang.org/grpc&#34;</span>
	<span class=c1>// &#34;google.golang.org/grpc/credentials&#34;
</span><span class=c1></span>
	<span class=nx>pb</span> <span class=s>&#34;github.com/bartmika/serialreader-server/proto&#34;</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
	<span class=c1>// The following are optional and will have defaults placed when missing.
</span><span class=c1></span>	<span class=nx>getDataCmd</span><span class=p>.</span><span class=nf>Flags</span><span class=p>().</span><span class=nf>IntVarP</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>port</span><span class=p>,</span> <span class=s>&#34;port&#34;</span><span class=p>,</span> <span class=s>&#34;p&#34;</span><span class=p>,</span> <span class=mi>50051</span><span class=p>,</span> <span class=s>&#34;The port of our server.&#34;</span><span class=p>)</span>
	<span class=nx>rootCmd</span><span class=p>.</span><span class=nf>AddCommand</span><span class=p>(</span><span class=nx>getDataCmd</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>doGetData</span><span class=p>()</span> <span class=p>{</span>
	<span class=c1>// Set up a direct connection to the gRPC server.
</span><span class=c1></span>	<span class=nx>conn</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>grpc</span><span class=p>.</span><span class=nf>Dial</span><span class=p>(</span>
		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;:%v&#34;</span><span class=p>,</span> <span class=nx>port</span><span class=p>),</span>
		<span class=nx>grpc</span><span class=p>.</span><span class=nf>WithInsecure</span><span class=p>(),</span>
		<span class=nx>grpc</span><span class=p>.</span><span class=nf>WithBlock</span><span class=p>(),</span>
	<span class=p>)</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;did not connect: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>

	<span class=c1>// Set up our protocol buffer interface.
</span><span class=c1></span>	<span class=nx>client</span> <span class=o>:=</span> <span class=nx>pb</span><span class=p>.</span><span class=nf>NewSerialReaderClient</span><span class=p>(</span><span class=nx>conn</span><span class=p>)</span>
	<span class=k>defer</span> <span class=nx>conn</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>

	<span class=nx>ctx</span><span class=p>,</span> <span class=nx>cancel</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>WithTimeout</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
	<span class=k>defer</span> <span class=nf>cancel</span><span class=p>()</span>

	<span class=c1>// Perform our gRPC request.
</span><span class=c1></span>	<span class=nx>tsd</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>GetSparkFunWeatherShieldData</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>pb</span><span class=p>.</span><span class=nx>GetTimeSeriesData</span><span class=p>{})</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;could not greet: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
	<span class=p>}</span>

	<span class=c1>// Print out the gRPC response.
</span><span class=c1></span>	<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Server Response:&#34;</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Status: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>Status</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;HumidityValue: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>HumidityValue</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;HumidityUnit: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>HumidityUnit</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;TemperatureValue: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>TemperatureValue</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;TemperatureUnit: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>TemperatureUnit</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;PressureValue: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>PressureValue</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;PressureUnit: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>PressureUnit</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;TemperatureBackupValue: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>TemperatureBackupValue</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;TemperatureBackupUnit: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>TemperatureBackupUnit</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;AltitudeValue: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>AltitudeValue</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;AltitudeUnit: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>AltitudeUnit</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;IlluminanceValue: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>IlluminanceValue</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;IlluminanceUnit: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>IlluminanceUnit</span><span class=p>)</span>
	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Timestamp: &#34;</span><span class=p>,</span> <span class=nx>tsd</span><span class=p>.</span><span class=nx>Timestamp</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>var</span> <span class=nx>getDataCmd</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>{</span>
	<span class=nx>Use</span><span class=p>:</span>   <span class=s>&#34;get_data&#34;</span><span class=p>,</span>
	<span class=nx>Short</span><span class=p>:</span> <span class=s>&#34;Poll data from the gRPC server&#34;</span><span class=p>,</span>
	<span class=nx>Long</span><span class=p>:</span>  <span class=s>`Connect to the gRPC server and poll the time series data. Command used to test out that the server is running.`</span><span class=p>,</span>
	<span class=nx>Run</span><span class=p>:</span> <span class=kd>func</span><span class=p>(</span><span class=nx>cmd</span> <span class=o>*</span><span class=nx>cobra</span><span class=p>.</span><span class=nx>Command</span><span class=p>,</span> <span class=nx>args</span> <span class=p>[]</span><span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
		<span class=nf>doGetData</span><span class=p>()</span>
	<span class=p>},</span>
<span class=p>}</span>
</code></pre></div><h2 id=usage-of-our-serial-data-reader-grpc-server>Usage of our Serial Data Reader gRPC Server</h2><p>In your primary <strong>terminal</strong>, please run the server by entering the following <strong>command</strong>:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>go run main.go serve -f<span class=o>=</span><span class=s2>&#34;/dev/cu.usbmodem14401&#34;</span></code></pre></div><p>Please note that the value <code>/dev/cu.usbmodem14401</code> was taken from the <strong>Arduino IDE</strong>, if you don&rsquo;t know how to get this value, please <a href=/post/2021/how-to-read-data-from-a-sparkfun-weather-shield-dev-13956-in-golang/>read this article</a>.</p><p>In another <strong>terminal window</strong> or <strong>terminal tab</strong>, please execute the following <strong>command</strong> to verify our server is working.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>go run main.go get_data</code></pre></div><p>You should see something like this:</p><p><img src=/img/2021/07-09/a3.png alt></p><p>If you see the above, congratulations! You have written a gRPC server overtop your serial reader so you can now write an unlimited applications to poll the data.</p><h2 id=where-do-we-go-from-here>Where do we go from here?</h2><p>You know how to read from the device and you now know how to serve it across many localhost applications or remote applications using <a href=https://grpc.io><code>gRPC</code></a>. The next logic step is figuring out <em>how</em> to store the time-series data we retrieved. In the <a href=/post/2021/how-to-build-a-grpc-server-over-tstorage-to-create-tstorage-server/>next post</a> we will discuss building a <a href=https://grpc.io><code>gRPC</code></a> server for storing and retrieving data.</p><div class=blog-tags><a href=https://bartlomiejmika.com/tags/iot/>IoT</a>&nbsp;
<a href=https://bartlomiejmika.com/tags/grpc/>gRPC</a>&nbsp;
<a href=https://bartlomiejmika.com/tags/golang/>Golang</a>&nbsp;</div><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fbartlomiejmika.com%2fpost%2f2021%2fhow-to-build-a-grpc-server-for-a-sparkfun-weather-shield%2f&text=How%20to%20Build%20a%20gRPC%20Server%20for%20a%20SparkFun%20Weather%20Shield&via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fbartlomiejmika.com%2fpost%2f2021%2fhow-to-build-a-grpc-server-for-a-sparkfun-weather-shield%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fbartlomiejmika.com%2fpost%2f2021%2fhow-to-build-a-grpc-server-for-a-sparkfun-weather-shield%2f&title=How%20to%20Build%20a%20gRPC%20Server%20for%20a%20SparkFun%20Weather%20Shield" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fbartlomiejmika.com%2fpost%2f2021%2fhow-to-build-a-grpc-server-for-a-sparkfun-weather-shield%2f&title=How%20to%20Build%20a%20gRPC%20Server%20for%20a%20SparkFun%20Weather%20Shield" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fbartlomiejmika.com%2fpost%2f2021%2fhow-to-build-a-grpc-server-for-a-sparkfun-weather-shield%2f&title=How%20to%20Build%20a%20gRPC%20Server%20for%20a%20SparkFun%20Weather%20Shield" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fbartlomiejmika.com%2fpost%2f2021%2fhow-to-build-a-grpc-server-for-a-sparkfun-weather-shield%2f&description=How%20to%20Build%20a%20gRPC%20Server%20for%20a%20SparkFun%20Weather%20Shield" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section><h4 class=see-also>See also</h4><ul><li><a href=/post/2021/docker-learning-resources-for-absolute-beginners-programming-with-golang/>Docker Learning Resources for Absolute Beginners Programming With Golang</a></li><li><a href=/post/2021/how-to-build-a-grpc-server-over-tstorage-to-create-tstorage-server/>How to Build a gRPC Server over tstorage to create tstorage-server</a></li><li><a href=/post/2021/how-to-read-data-from-a-sparkfun-weather-shield-dev-13956-in-golang/>How to Read Data From a SparkFun Weather Shield (DEV-13956) in Golang</a></li><li><a href=/post/2021/how-to-do-dynamic-filtering-in-golang-using-only-the-database-sql-package-like-in-django/>How to do Dynamic Filtering in Golang using only the Database SQL Package like in Django</a></li><li><a href=/post/2021/how-to-get-go2tv-working-with-your-samsung-smart-tv/>How to Get Go2TV Working With Your Samsung Smart TV</a></li></ul></article><ul class="pager blog-pager"><li class=previous><a href=https://bartlomiejmika.com/post/2021/how-to-read-data-from-a-sparkfun-weather-shield-dev-13956-in-golang/ data-toggle=tooltip data-placement=top title="How to Read Data From a SparkFun Weather Shield (DEV-13956) in Golang">&larr; Previous Post</a></li><li class=next><a href=https://bartlomiejmika.com/post/2021/how-to-build-a-grpc-server-over-tstorage-to-create-tstorage-server/ data-toggle=tooltip data-placement=top title="How to Build a gRPC Server over tstorage to create tstorage-server">Next Post &rarr;</a></li></ul><div class=disqus-comments><button id=show-comments class="btn btn-default" type=button>Show <span class=disqus-comment-count data-disqus-url=https://bartlomiejmika.com/post/2021/how-to-build-a-grpc-server-for-a-sparkfun-weather-shield>comments</span></button><div id=disqus_thread></div><script type=text/javascript>var disqus_config=function(){this.page.url='https:\/\/bartlomiejmika.com\/post\/2021\/how-to-build-a-grpc-server-for-a-sparkfun-weather-shield';};</script></div></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:bart@mikasoftware.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://www.facebook.com/bartlomiej-mika title=Facebook><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/bartmika title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://reddit.com/u/eurasiasoft title=Reddit><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-reddit-alien fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/bartlomiej-mika-a9a5683b title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i><i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://mikasoftware.com>Mika Software Corporation</a>
&nbsp;&bull;&nbsp;&copy;
2021
&nbsp;&bull;&nbsp;
<a href=https://bartlomiejmika.com>Bartlomiej Mika</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.80.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script><script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script src=https://bartlomiejmika.com/js/main.js></script><script src=https://bartlomiejmika.com/js/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0");});</script><script>renderMathInElement(document.body);</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://bartlomiejmika.com/js/load-photoswipe.js></script><script type=text/javascript>$(function(){$('#show-comments').on('click',function(){var disqus_shortname='bartlomiej-mika';(function(){var disqus=document.createElement('script');disqus.type='text/javascript';disqus.async=true;disqus.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(disqus);})();$(this).hide();});});</script><script id=dsq-count-scr src=//bartlomiej-mika.disqus.com/count.js async></script></body></html>