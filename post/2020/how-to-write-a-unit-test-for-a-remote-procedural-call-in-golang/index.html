<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>How to Write a Unit Test for a Remote Procedural Call in Golang - Bartlomiej Mika</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Bartlomiej Mika"><meta name=description content="Recently I have been learning about remote procedural calls (RPCs) in *Golang and realized I was unable to find an easy example on how to write a unit test for RPCs. In this post, I&amp;rsquo;ll explain how I figured out a solution."><meta name=keywords content="Golang,Web Development,Engineering"><meta name=generator content="Hugo 0.80.0 with theme even"><link rel=canonical href=https://bartmika.github.io/post/2020/how-to-write-a-unit-test-for-a-remote-procedural-call-in-golang/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.2e81bbed97b8b282c1aeb57488cc71c8d8c8ec559f3931531bd396bf31e0d4dd.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="How to Write a Unit Test for a Remote Procedural Call in Golang"><meta property="og:description" content="Recently I have been learning about remote procedural calls (RPCs) in *Golang and realized I was unable to find an easy example on how to write a unit test for RPCs. In this post, I&rsquo;ll explain how I figured out a solution."><meta property="og:type" content="article"><meta property="og:url" content="https://bartmika.github.io/post/2020/how-to-write-a-unit-test-for-a-remote-procedural-call-in-golang/"><meta property="article:published_time" content="2020-08-13T23:14:55-04:00"><meta property="article:modified_time" content="2020-08-13T23:14:55-04:00"><meta itemprop=name content="How to Write a Unit Test for a Remote Procedural Call in Golang"><meta itemprop=description content="Recently I have been learning about remote procedural calls (RPCs) in *Golang and realized I was unable to find an easy example on how to write a unit test for RPCs. In this post, I&rsquo;ll explain how I figured out a solution."><meta itemprop=datePublished content="2020-08-13T23:14:55-04:00"><meta itemprop=dateModified content="2020-08-13T23:14:55-04:00"><meta itemprop=wordCount content="546"><meta itemprop=keywords content="Golang,RPC,Unit Testing,HOWTO,"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to Write a Unit Test for a Remote Procedural Call in Golang"><meta name=twitter:description content="Recently I have been learning about remote procedural calls (RPCs) in *Golang and realized I was unable to find an easy example on how to write a unit test for RPCs. In this post, I&rsquo;ll explain how I figured out a solution."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Bartlomiej Mika</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Bartlomiej Mika</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>How to Write a Unit Test for a Remote Procedural Call in Golang</h1><div class=post-meta><span class=post-time>2020-08-13</span><div class=post-category><a href=/categories/programming/>Programming</a></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#assumption>Assumption</a></li><li><a href=#what-is-a-remote-procedural-call>What is a remote procedural call?</a></li><li><a href=#how-does-rpc-work-in-golang>How does RPC work in Golang?</a></li><li><a href=#how-to-unit-test>How to Unit Test?</a></li></ul></li></ul></nav></div></div><div class=post-content><p>Recently I have been learning about <strong>remote procedural calls</strong> (RPCs) in *<em>Golang</em> and realized I was unable to find an easy example on how to write a unit test for RPCs. In this post, I&rsquo;ll explain how I figured out a solution.</p><h2 id=assumption>Assumption</h2><p>Before I begin, I am assuming you are just starting to learn about <strong>remote procedural calls</strong> (RPCs) and you don&rsquo;t know how you would go about writing a single unit test.</p><h2 id=what-is-a-remote-procedural-call>What is a remote procedural call?</h2><p>According to <a href=https://en.wikipedia.org/wiki/Remote_procedure_call>this Wikipedia article</a>:</p><blockquote><p>a <strong>remote procedure call (RPC)</strong> is when a computer program causes a procedure (subroutine) to execute in a different address space (commonly on another computer on a shared network), which is coded as if it were a normal (local) procedure call, without the programmer explicitly coding the details for the remote interaction. That is, the programmer writes essentially the same code whether the subroutine is local to the executing program, or remote.</p></blockquote><p>So in essence you can write a bunch of <strong>functions</strong> in your application, serve these functions over the network and other programmers can call your functions locally on their computer and not worry about the network interaction - <em>how cool is that</em>?</p><h2 id=how-does-rpc-work-in-golang>How does RPC work in Golang?</h2><p>I will skip this section and refer you to an excellent resource I used to learn how RPC works in Golang. Please checkout <a href=https://tumregels.github.io/Network-Programming-with-Go/rpc/go_rpc.html>Chapter 13 Remote Procedure Call via
&ldquo;Network Programming with Go&rdquo; by Levon</a>.</p><h2 id=how-to-unit-test>How to Unit Test?</h2><p>Let&rsquo;s pretend you have written the following RPC methods which you want to serve in your RPC server:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>// mathrpc.go
</span><span class=c1></span><span class=kn>package</span> <span class=nx>mathrpc</span>

<span class=kd>type</span> <span class=nx>Args</span> <span class=kd>struct</span> <span class=p>{</span>
    <span class=nx>A</span><span class=p>,</span> <span class=nx>B</span> <span class=kt>int</span>
<span class=p>}</span>

<span class=kd>type</span> <span class=nx>Quotient</span> <span class=kd>struct</span> <span class=p>{</span>
    <span class=nx>Quo</span><span class=p>,</span> <span class=nx>Rem</span> <span class=kt>int</span>
<span class=p>}</span>

<span class=kd>type</span> <span class=nx>Arith</span> <span class=kt>int</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Arith</span><span class=p>)</span> <span class=nf>Multiply</span><span class=p>(</span><span class=nx>args</span> <span class=o>*</span><span class=nx>Args</span><span class=p>,</span> <span class=nx>reply</span> <span class=o>*</span><span class=kt>int</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
    <span class=o>*</span><span class=nx>reply</span> <span class=p>=</span> <span class=nx>args</span><span class=p>.</span><span class=nx>A</span> <span class=o>*</span> <span class=nx>args</span><span class=p>.</span><span class=nx>B</span>
    <span class=k>return</span> <span class=kc>nil</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>Arith</span><span class=p>)</span> <span class=nf>Divide</span><span class=p>(</span><span class=nx>args</span> <span class=o>*</span><span class=nx>Args</span><span class=p>,</span> <span class=nx>quo</span> <span class=o>*</span><span class=nx>Quotient</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
    <span class=k>if</span> <span class=nx>args</span><span class=p>.</span><span class=nx>B</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
        <span class=k>return</span> <span class=kt>error</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=s>&#34;divide by zero&#34;</span><span class=p>)</span>
    <span class=p>}</span>
    <span class=nx>quo</span><span class=p>.</span><span class=nx>Quo</span> <span class=p>=</span> <span class=nx>args</span><span class=p>.</span><span class=nx>A</span> <span class=o>/</span> <span class=nx>args</span><span class=p>.</span><span class=nx>B</span>
    <span class=nx>quo</span><span class=p>.</span><span class=nx>Rem</span> <span class=p>=</span> <span class=nx>args</span><span class=p>.</span><span class=nx>A</span> <span class=o>%</span> <span class=nx>args</span><span class=p>.</span><span class=nx>B</span>
    <span class=k>return</span> <span class=kc>nil</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>How would you unit test the above code? You can write code as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-go data-lang=go><span class=c1>//mathrpc_test.go
</span><span class=c1></span><span class=kn>package</span> <span class=nx>mathrpc</span>

<span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;testing&#34;</span>

	<span class=s>&#34;github.com/stretchr/testify/assert&#34;</span>
<span class=p>)</span>

<span class=kd>func</span> <span class=nf>TestMultiplyWithSuccess</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
	<span class=c1>// Setup our test.
</span><span class=c1></span>	<span class=nx>arith</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>Arith</span><span class=p>)</span>
	<span class=nx>args</span> <span class=o>:=</span> <span class=nx>Args</span><span class=p>{</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>}</span>
	<span class=kd>var</span> <span class=nx>reply</span> <span class=kt>int</span>

	<span class=c1>// Perform our operation.
</span><span class=c1></span>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>arith</span><span class=p>.</span><span class=nf>Multiply</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>args</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>reply</span><span class=p>)</span>

    <span class=c1>// Perform our validation
</span><span class=c1></span>	<span class=nx>assert</span><span class=p>.</span><span class=nf>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
	<span class=nx>assert</span><span class=p>.</span><span class=nf>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=nx>reply</span><span class=p>,</span> <span class=s>&#34;Did not multiply correctly!`&#34;</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>TestDivideWithSuccess</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
	<span class=c1>// Setup our test.
</span><span class=c1></span>	<span class=nx>arith</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>Arith</span><span class=p>)</span>
	<span class=nx>args</span> <span class=o>:=</span> <span class=nx>Args</span><span class=p>{</span><span class=mi>17</span><span class=p>,</span> <span class=mi>8</span><span class=p>}</span>
	<span class=kd>var</span> <span class=nx>reply</span> <span class=nx>Quotient</span>

	<span class=c1>// Perform our operation.
</span><span class=c1></span>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>arith</span><span class=p>.</span><span class=nf>Divide</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>args</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>reply</span><span class=p>)</span>

    <span class=c1>// Perform our validation
</span><span class=c1></span>	<span class=nx>assert</span><span class=p>.</span><span class=nf>NoError</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
	<span class=nx>assert</span><span class=p>.</span><span class=nf>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=nx>reply</span><span class=p>.</span><span class=nx>Quo</span><span class=p>,</span> <span class=s>&#34;Did not return correct quotient`&#34;</span><span class=p>)</span>
    <span class=nx>assert</span><span class=p>.</span><span class=nf>Equal</span><span class=p>(</span><span class=nx>t</span><span class=p>,</span> <span class=mi>125</span><span class=p>,</span> <span class=nx>reply</span><span class=p>.</span><span class=nx>Rem</span><span class=p>,</span> <span class=s>&#34;Did not return correct remainder`&#34;</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>As you can see, it&rsquo;s not too difficult to write a unit test on an RPC; in essence, you can treat the RPC function as if was a plain function and write a plain unit test on it.</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>Bartlomiej Mika</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2020-08-13</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/golang/>Golang</a>
<a href=/tags/rpc/>RPC</a>
<a href=/tags/unit-testing/>Unit Testing</a>
<a href=/tags/howto/>HOWTO</a></div><nav class=post-nav><a class=prev href=/post/2020/how-to-start-a-personal-blog-with-hugo-a-static-site-generator-written-in-go-part-1/><i class="iconfont icon-left"></i><span class="prev-text nav-default">How to Start a Personal Blog With Hugo a Static Site Generator Written in Go (Part 1)</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/2020/how-to-setup-peercoin-on-raspberry-pi-for-headless-minting/><span class="next-text nav-default">How to Setup Peercoin on Raspberry Pi for Headless Minting</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname==='localhost')return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='bartlomiej-mika';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:bart@mikasoftware.com class="iconfont icon-email" title=email></a><a href=bartlomiej-mika-a9a5683b class="iconfont icon-linkedin" title=linkedin></a><a href=https://github.com/bartmika class="iconfont icon-github" title=github></a><a href=https://bartmika.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2020 -
2021<span class=heart><i class="iconfont icon-heart"></i></span><span>Bartlomiej Mika</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-172742383-1','auto');ga('set','anonymizeIp',true);ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>