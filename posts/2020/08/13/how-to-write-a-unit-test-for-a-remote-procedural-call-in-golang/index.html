<!doctype html><html lang=en data-theme=dark><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>How to Write a Unit Test for a Remote Procedural Call in Golang - Bartlomiej Mika</title><meta name=description content="My personal blog."><link rel=icon type=image/x-icon href=https://bartlomiejmika.com/favicon.ico><link rel=apple-touch-icon-precomposed href=https://bartlomiejmika.com/favicon.png><link rel=stylesheet href="https://bartlomiejmika.com/css/light.css?rnd=1597378903"><style>:root{--font-color: #eee;--bg-color: #212121;--link-color:#599ada;--link-state-color:#ff5858;--link-state-border-color: rgba(238, 54, 54, 0.5);--thead-bg-color: #343a40;--table-border-color: lightgrey;--pre-color: #333;--pre-bg-color: #f1f1f1;--bq-color: #ccc;--hr-color: #ccc;--pagination-bg-color: #373737;--pagination-link-color: #b6b6b6;--post-info-color: grey;--switcher-color: #333;--switcher-bg-color: #fff}</style><link rel=stylesheet href="https://bartlomiejmika.com/css/style.css?rnd=1597378903"><meta property="og:title" content="How to Write a Unit Test for a Remote Procedural Call in Golang"><meta property="og:description" content="Recently I have been learning about remote procedural calls (RPCs) in *Golang and realized I was unable to find an easy example on how to write a unit test for RPCs. In this post, I&rsquo;ll explain how I figured out a solution."><meta property="og:type" content="article"><meta property="og:url" content="https://bartlomiejmika.com/posts/2020/08/13/how-to-write-a-unit-test-for-a-remote-procedural-call-in-golang/"><meta property="article:published_time" content="2020-08-13T23:14:55-04:00"><meta property="article:modified_time" content="2020-08-13T23:14:55-04:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to Write a Unit Test for a Remote Procedural Call in Golang"><meta name=twitter:description content="Recently I have been learning about remote procedural calls (RPCs) in *Golang and realized I was unable to find an easy example on how to write a unit test for RPCs. In this post, I&rsquo;ll explain how I figured out a solution."></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><h1 class=site-title><a href=/>Bartlomiej Mika</a></h1><nav><a href=https://bartlomiejmika.com/tags/>Tags</a>
<a href=https://bartlomiejmika.com/posts/>Archive</a></nav></header><main id=main tabindex=-1><article class=post><header class=post-header><h1 class=post-title>How to Write a Unit Test for a Remote Procedural Call in Golang</h1></header><div class=content><p>Recently I have been learning about <strong>remote procedural calls</strong> (RPCs) in *<em>Golang</em> and realized I was unable to find an easy example on how to write a unit test for RPCs. In this post, I&rsquo;ll explain how I figured out a solution.</p><h2 id=assumption>Assumption</h2><p>Before I begin, I am assuming you are just starting to learn about <strong>remote procedural calls</strong> (RPCs) and you don&rsquo;t know how you would go about writing a single unit test.</p><h2 id=what-is-a-remote-procedural-call>What is a remote procedural call?</h2><p>According to <a href=https://en.wikipedia.org/wiki/Remote_procedure_call>this Wikipedia article</a>:</p><blockquote><p>a <strong>remote procedure call (RPC)</strong> is when a computer program causes a procedure (subroutine) to execute in a different address space (commonly on another computer on a shared network), which is coded as if it were a normal (local) procedure call, without the programmer explicitly coding the details for the remote interaction. That is, the programmer writes essentially the same code whether the subroutine is local to the executing program, or remote.</p></blockquote><p>So in essence you can write a bunch of <strong>functions</strong> in your application, serve these functions over the network and other programmers can call your functions locally on their computer and not worry about the network interaction - <em>how cool is that</em>?</p><h2 id=how-does-rpc-work-in-golang>How does RPC work in Golang?</h2><p>I will skip this section and refer you to an excellent resource I used to learn how RPC works in Golang. Please checkout <a href=https://tumregels.github.io/Network-Programming-with-Go/rpc/go_rpc.html>Chapter 13 Remote Procedure Call via
&ldquo;Network Programming with Go&rdquo; by Levon</a>.</p><h2 id=how-to-unit-test>How to Unit Test?</h2><p>Let&rsquo;s pretend you have written the following RPC methods which you want to serve in your RPC server:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>// mathrpc.go
</span><span style=color:#75715e></span><span style=color:#f92672>package</span> <span style=color:#a6e22e>mathrpc</span>

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Args</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>A</span>, <span style=color:#a6e22e>B</span> <span style=color:#66d9ef>int</span>
}

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Quotient</span> <span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>Quo</span>, <span style=color:#a6e22e>Rem</span> <span style=color:#66d9ef>int</span>
}

<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Arith</span> <span style=color:#66d9ef>int</span>

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Arith</span>) <span style=color:#a6e22e>Multiply</span>(<span style=color:#a6e22e>args</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Args</span>, <span style=color:#a6e22e>reply</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>error</span> {
    <span style=color:#f92672>*</span><span style=color:#a6e22e>reply</span> = <span style=color:#a6e22e>args</span>.<span style=color:#a6e22e>A</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>args</span>.<span style=color:#a6e22e>B</span>
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}

<span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Arith</span>) <span style=color:#a6e22e>Divide</span>(<span style=color:#a6e22e>args</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Args</span>, <span style=color:#a6e22e>quo</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Quotient</span>) <span style=color:#66d9ef>error</span> {
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>args</span>.<span style=color:#a6e22e>B</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>error</span>.<span style=color:#a6e22e>String</span>(<span style=color:#e6db74>&#34;divide by zero&#34;</span>)
    }
    <span style=color:#a6e22e>quo</span>.<span style=color:#a6e22e>Quo</span> = <span style=color:#a6e22e>args</span>.<span style=color:#a6e22e>A</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>args</span>.<span style=color:#a6e22e>B</span>
    <span style=color:#a6e22e>quo</span>.<span style=color:#a6e22e>Rem</span> = <span style=color:#a6e22e>args</span>.<span style=color:#a6e22e>A</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>args</span>.<span style=color:#a6e22e>B</span>
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}
</code></pre></div><p>How would you unit test the above code? You can write code as follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#75715e>//mathrpc_test.go
</span><span style=color:#75715e></span><span style=color:#f92672>package</span> <span style=color:#a6e22e>mathrpc</span>

<span style=color:#f92672>import</span> (
	<span style=color:#e6db74>&#34;testing&#34;</span>

	<span style=color:#e6db74>&#34;github.com/stretchr/testify/assert&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestMultiplyWithSuccess</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
	<span style=color:#75715e>// Setup our test.
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>arith</span> <span style=color:#f92672>:=</span> new(<span style=color:#a6e22e>Arith</span>)
	<span style=color:#a6e22e>args</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Args</span>{<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>2</span>}
	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>reply</span> <span style=color:#66d9ef>int</span>

	<span style=color:#75715e>// Perform our operation.
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>arith</span>.<span style=color:#a6e22e>Multiply</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>args</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>reply</span>)

    <span style=color:#75715e>// Perform our validation
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>assert</span>.<span style=color:#a6e22e>NoError</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>err</span>)
	<span style=color:#a6e22e>assert</span>.<span style=color:#a6e22e>Equal</span>(<span style=color:#a6e22e>t</span>, <span style=color:#ae81ff>6</span>, <span style=color:#a6e22e>reply</span>, <span style=color:#e6db74>&#34;Did not multiply correctly!`&#34;</span>)
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestDivideWithSuccess</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
	<span style=color:#75715e>// Setup our test.
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>arith</span> <span style=color:#f92672>:=</span> new(<span style=color:#a6e22e>Arith</span>)
	<span style=color:#a6e22e>args</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Args</span>{<span style=color:#ae81ff>17</span>, <span style=color:#ae81ff>8</span>}
	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>reply</span> <span style=color:#a6e22e>Quotient</span>

	<span style=color:#75715e>// Perform our operation.
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>arith</span>.<span style=color:#a6e22e>Divide</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>args</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>reply</span>)

    <span style=color:#75715e>// Perform our validation
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>assert</span>.<span style=color:#a6e22e>NoError</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>err</span>)
	<span style=color:#a6e22e>assert</span>.<span style=color:#a6e22e>Equal</span>(<span style=color:#a6e22e>t</span>, <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>reply</span>.<span style=color:#a6e22e>Quo</span>, <span style=color:#e6db74>&#34;Did not return correct quotient`&#34;</span>)
    <span style=color:#a6e22e>assert</span>.<span style=color:#a6e22e>Equal</span>(<span style=color:#a6e22e>t</span>, <span style=color:#ae81ff>125</span>, <span style=color:#a6e22e>reply</span>.<span style=color:#a6e22e>Rem</span>, <span style=color:#e6db74>&#34;Did not return correct remainder`&#34;</span>)
}
</code></pre></div><p>As you can see, it&rsquo;s not too difficult to write a unit test on an RPC; in essence, you can treat the RPC function as if was a plain function and write a plain unit test on it.</p></div><div class=post-info><div class=post-date>2020-08-13</div><div class=post-taxonomies><ul class=post-categories><li><a href=https://bartlomiejmika.com/categories/development>development</a></li></ul><ul class=post-tags><li><a href=https://bartlomiejmika.com/tags/go>#go</a></li><li><a href=https://bartlomiejmika.com/tags/golang>#golang</a></li><li><a href=https://bartlomiejmika.com/tags/rpc>#rpc</a></li><li><a href=https://bartlomiejmika.com/tags/unit-testing>#unit-testing</a></li></ul></div></div></article><div class="pagination post-pagination"><div class="left pagination-item disabled"></div><div class="right pagination-item"><a href=/posts/2020/07/26/how-to-setup-peercoin-on-raspberry-pi-for-headless-minting/>How to Setup Peercoin on Raspberry Pi for Headless Minting</a></div></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"bartlomiej-mika"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></main><footer class=common-footer><div class=copyright><p>© Bartlomiej Mika, 2020<br>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.</p></div></footer></div></body></html>